# Robust Savitzky-Golay Filter Library Structure

This document outlines the structure and components of the Robust Savitzky-Golay Filter Library.

## Directory Structure

```
sglib/  
├─ include/
│   └─ sglib_mod.f90       # Public types and interface declarations  
├─ src/
│   ├─ sg_coeff.f90        # Coefficient calculation module  
│   ├─ sg_filter.f90       # Convolution filtering and robust outlier detection module  
│   └─ main_test.f90       # Test example  
│   ├─ test_sg_filter_data.f90     # Fortran program for custom data tests
├─ scripts/
│   ├─ plot_results.py     # Visualization script for test results
│   ├─ generate_test_data.py # Script to generate synthetic test data
│   ├─ run_demo.sh         # Demo workflow script
│   └─ Makefile            # Scripts build configuration
├─ Makefile                # Main build configuration
├─ README.md               # Library documentation
├─ verify.sh               # Verification script
└─ PROJECT_STRUCTURE.md    # This file
```

## Components

### Module Files

1. **sglib_mod.f90**
   - Primary module file with public interfaces
   - Defines the API that users will interact with
   - Contains interface declarations for all public procedures

2. **sg_coeff.f90**
   - Implements coefficient calculation for Savitzky-Golay filter
   - Uses LAPACK's DGELS routine for solving least squares problems
   - Handles matrix operations for computing filter coefficients

3. **sg_filter.f90**
   - Implements the actual filtering process
   - Contains standard SG filtering routine
   - Contains robust filtering with configurable outlier detection (default: 3-sigma rule)
   - Handles boundary conditions for window operations

4. **main_test.f90**
   - Test program demonstrating library usage
   - Generates synthetic data with noise and outliers
   - Applies both standard and robust filtering
   - Outputs results for comparison

### Scripts and Visualization Tools

1. **plot_results.py**
   - Python script for visualizing filter results
   - Creates comparison plots of original, noisy, and filtered data
   - Calculates and displays error metrics (MSE)

2. **generate_test_data.py**
   - Creates synthetic test data with configurable parameters
   - Adds controlled noise and outliers
   - Allows for reproducible test cases

3. **custom_test.f90**
   - Fortran program that uses the SGLib with custom input data
   - Can process data generated by Python scripts
   - Configurable window size and polynomial order

4. **run_demo.sh**
   - Shell script orchestrating the complete demo workflow
   - Builds library, runs tests, and generates visualizations

### Build and Documentation Files

1. **Makefile**
   - Configures build process
   - Creates both static and shared libraries
   - Builds test program
   - Handles dependencies between modules

2. **README.md**
   - User documentation
   - Installation and usage instructions
   - API reference

3. **verify.sh**
   - Verification script to check build and test execution
   - Confirms required dependencies are installed
   - Checks build process completes successfully
   - Verifies test program runs correctly

## Implementation Details

### Savitzky-Golay Filter Algorithm

The Savitzky-Golay filter smooths data by fitting a polynomial of specified order to a sliding window of points and replacing the center point with the fitted value. This preserves higher moments of the data better than simple moving average filters.

### Configurable Robust Outlier Detection

The robust implementation extends the standard SG filter by:

1. For each window position:
   - Calculating the mean (μ) and standard deviation (σ) of points in the window
   - Identifying outliers as points that deviate more than rate×σ from μ, where rate is configurable (default: 3.0)
   - Replacing outliers with the mean value
   - Applying the SG filter to the cleaned window

### Key Features

1. **Separation of Coefficient Calculation**:
   - Filter coefficients can be pre-computed once and reused
   - Same coefficients can be applied to multiple datasets

2. **Configurable Parameters**:
   - Window size (half-width m)
   - Polynomial order
   - Outlier detection sensitivity (rate parameter)

3. **Robust Outlier Detection**:
   - Configurable sigma-based rule applied iteratively (default: 3-sigma)
   - Rate parameter controls outlier detection sensitivity
   - Prevents outliers from significantly affecting filter results

4. **Minimal Dependencies**:
   - Only requires standard Fortran compiler
   - OpenBLAS/LAPACK for matrix operations
   - No other external libraries needed

## Usage

See README.md for detailed usage instructions and examples. 